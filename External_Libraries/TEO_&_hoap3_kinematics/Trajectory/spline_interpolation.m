function [x_traj, dx_traj, ddx_traj] = spline_interpolation (P1, P2, Ts)
%SPLINE_INTERPOLATION Cubic spline trajectory interpolation.
%	[X_TRAJ, DX_TRAJ, DDX_TRAJ] = SPLINE_INTERPOLATION (P1, P2, TS)
%	provides the trajectory spline interpolant of the points P1 and P2 with
%	sampling time Ts. P1 and P2 must represent the initial and final
%	conditions. They are struct with position, velocity and acceleration,
%	defined by the function SET_TRAJECTORY_CONDITION.
%
%   Example:
%       P1 = set_trajectory_condition(0, rand(3,1), rand(3,1), rand(3,1));
%       P2 = set_trajectory_condition(2, rand(3,1), rand(3,1), rand(3,1));
%       [x, dx, ddx] = spline_interpolation (P1, P2, 1e-3);
%

%   See also SET_TRAJECTORY_CONDITION, SPLINE.

%   Author: Paolo Pierro
%   $Revision: 1.0 $  $Date: 2011/02/04 $

% Avoid possible quantization troubles
t1 = round_to_Ts(P1.t, Ts);
t2 = round_to_Ts(P2.t, Ts);

% Define time vector
tt = 0:Ts:(t2-t1);
L = length(tt);

% Define (extra) via points (corrected due to round error)
t_a = round_to_Ts((t2-t1)/3, Ts);
t_b = round_to_Ts((t2-t1)*2/3, Ts);

% Prepare output
n   = size(P1.x, 1);
x   = zeros(n,L);
dx  = zeros(n,L);
ddx = zeros(n,L);

% Determine coefficients
pc1.a  = (9*P2.x - 9*P1.x + (t2-t1)^2*(P2.ddx/3 - (11*P1.ddx)/6) + 0^2*(P2.ddx/3 - (47*P1.ddx)/6) + 0*(12*P1.dx - 3*P2.dx + (t2-t1)*((5*P2.ddx)/6 + (49*P1.ddx)/6)) - (t2-t1)*(3*P2.dx + 6*P1.dx))/(2*(t2-t1)^3 - 15*(t2-t1)^2*0 + 33*(t2-t1)*0^2 - 20*0^3);
pc1.b  = P1.ddx/2;
pc1.c  = P1.dx;
pc1.d  = P1.x;
pc1.t_ = 0;

pc2.a  = -(216*P2.x - 216*P1.x + (t2-t1)^2*(14*P2.ddx - 14*P1.ddx) - (t2-t1)*(108*P2.dx + 108*P1.dx - 17*P2.ddx*0 - 73*P1.ddx*0) + 18*0*P2.dx + 198*0*P1.dx - 22*P2.ddx*0^2 - 68*P1.ddx*0^2)/(24*(t2-t1)^3 - 72*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 30*0^3);
pc2.b  = 27*P2.x/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 27*P1.x/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 3/2*P2.ddx*(t2-t1)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 6*P2.ddx*0^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 5/2*P1.ddx*(t2-t1)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 22*P1.ddx*0^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 9*(t2-t1)*P2.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 18*(t2-t1)*P1.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 18*0*P2.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 45*0*P1.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 6*P2.ddx*(t2-t1)*0/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 31/2*P1.ddx*(t2-t1)*0/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + (t2-t1)^3/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 8*0^3/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + (t2-t1)^3/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx))) - 0^3/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx))) + 12*(t2-t1)*0^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 6*(t2-t1)^2*0/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 3*(t2-t1)*0^2/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx))) - 3*(t2-t1)^2*0/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)));
pc2.c  = -(216*P2.x*0 - 54*P2.x*(t2-t1) + 54*P1.x*(t2-t1) - 216*P1.x*0 - 5*P2.ddx*(t2-t1)^3 + 32*P2.ddx*0^3 - 60*P1.ddx*0^3 + 24*(t2-t1)^2*P2.dx + 6*(t2-t1)^2*P1.dx - 120*0^2*P2.dx + 186*0^2*P1.dx + 48*P2.ddx*(t2-t1)*0^2 + 6*P2.ddx*(t2-t1)^2*0 + 39*P1.ddx*(t2-t1)*0^2 - 6*P1.ddx*(t2-t1)^2*0 - (4*(t2-t1)^4*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)))/(18*(t2-t1)*0^2 - 18*(t2-t1)^2*0 - 12*(t2-t1)^3 + 12*0^3) + (32*0^4*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)))/(18*(t2-t1)*0^2 - 18*(t2-t1)^2*0 - 12*(t2-t1)^3 + 12*0^3) - 66*(t2-t1)*0*P2.dx - 84*(t2-t1)*0*P1.dx + (48*(t2-t1)^2*0^2*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)))/(18*(t2-t1)*0^2 - 18*(t2-t1)^2*0 - 12*(t2-t1)^3 + 12*0^3) + (88*(t2-t1)*0^3*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)))/(18*(t2-t1)*0^2 - 18*(t2-t1)^2*0 - 12*(t2-t1)^3 + 12*0^3) - (2*(t2-t1)^3*0*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)))/(18*(t2-t1)*0^2 - 18*(t2-t1)^2*0 - 12*(t2-t1)^3 + 12*0^3))/(6*(2*(t2-t1) - 5*0)^2);
pc2.d  = 1/18*P2.ddx*(t2-t1)^4/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 32/9*P2.ddx*0^4/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 1/6*P1.ddx*(t2-t1)^4/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 16/3*P1.ddx*0^4/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + P2.x*(t2-t1)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 16*P2.x*0^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 6*P1.x*(t2-t1)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 15*P1.x*0^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 1/3*(t2-t1)^3*P2.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 5/3*(t2-t1)^3*P1.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 32/3*0^3*P2.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 44/3*0^3*P1.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 8*P2.x*(t2-t1)*0/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 21*P1.x*(t2-t1)*0/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 16/9*P2.ddx*(t2-t1)*0^3/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 2/9*P2.ddx*(t2-t1)^3*0/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 32/3*P1.ddx*(t2-t1)*0^3/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 11/6*P1.ddx*(t2-t1)^3*0/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 2*(t2-t1)^2*0*P2.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 25*(t2-t1)*0^2*P1.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 12*(t2-t1)^2*0*P1.dx/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) - 2/3*P2.ddx*(t2-t1)^2*0^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 7*P1.ddx*(t2-t1)^2*0^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2) + 1/27*(t2-t1)^5/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 128/27*0^5/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 1/27*(t2-t1)^5/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx))) - 16/27*0^5/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx))) + 128/27*(t2-t1)*0^4/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 2/27*(t2-t1)^4*0/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 56/27*(t2-t1)*0^4/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx))) - 11/27*(t2-t1)^4*0/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx))) + 8/27*(t2-t1)^2*0^3/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 20/27*(t2-t1)^3*0^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 73/27*(t2-t1)^2*0^3/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx))) + 43/27*(t2-t1)^3*0^2/(2*(t2-t1)^2 - 7*(t2-t1)*0 + 5*0^2)^2/(7*(t2-t1)^2 - 29*(t2-t1)*0 + 31*0^2)*(81*P2.x*(t2-t1) - 162*P2.x*0 - 81*P1.x*(t2-t1) + 162*P1.x*0 + 23/2*P2.ddx*(t2-t1)^3 + 26*P2.ddx*0^3 - 4*P1.ddx*(t2-t1)^3 + 70*P1.ddx*0^3 - 48*(t2-t1)^2*P2.dx - 33*(t2-t1)^2*P1.dx + 15*0^2*P2.dx - 177*0^2*P1.dx - 45*P2.ddx*(t2-t1)*0^2 - 6*P2.ddx*(t2-t1)^2*0 - 171/2*P1.ddx*(t2-t1)*0^2 + 33*P1.ddx*(t2-t1)^2*0 + 10*(t2-t1)^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 76*0^4/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 87*(t2-t1)*0*P2.dx + 156*(t2-t1)*0*P1.dx - 57*(t2-t1)^2*0^2/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) - 40*(t2-t1)*0^3/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)) + 11*(t2-t1)^3*0/(- 12*(t2-t1)^3 - 18*(t2-t1)^2*0 + 18*(t2-t1)*0^2 + 12*0^3)*(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx)));
pc2.t_ = t_a;
 
pc3.a = -(54*P2.x - 54*P1.x + (t2-t1)^2*(11*P2.ddx - 2*P1.ddx) - 0^2*(7*P2.ddx + 20*P1.ddx) + 0*(54*P1.dx + (t2-t1)*(5*P2.ddx + 13*P1.ddx)) - (t2-t1)*(36*P2.dx + 18*P1.dx))/(18*(t2-t1)*0^2 - 18*(t2-t1)^2*0 - 12*(t2-t1)^3 + 12*0^3);
pc3.b = -(54*P1.x - 54*P2.x + 36*(t2-t1)*P2.dx + 18*(t2-t1)*P1.dx - 54*0*P1.dx - 5*P2.ddx*(t2-t1)^2 + 4*P2.ddx*0^2 + 2*P1.ddx*(t2-t1)^2 + 20*P1.ddx*0^2 - 8*P2.ddx*(t2-t1)*0 - 13*P1.ddx*(t2-t1)*0)/(6*((t2-t1)*0 - 2*(t2-t1)^2 + 0^2));
pc3.c = (54*P2.x - 54*P1.x - 36*0*P2.dx + 36*0*P1.dx + 9*P2.ddx*0^2 - 9*P1.ddx*0^2)/(18*((t2-t1) - 0)) - P1.dx/2 - (54*P2.x - 54*P1.x + 18*0*P2.dx + 63*0*P1.dx - (27*P2.ddx*0^2)/4 - 27*P1.ddx*0^2)/(18*(2*(t2-t1) + 0)) + (P2.ddx*0)/4 + (P1.ddx*0)/4 - (t2-t1)*(P2.ddx/36 + P1.ddx/18) - (0*(P2.ddx/36 + P1.ddx/18))/2;
pc3.d = -(7*P2.ddx*(t2-t1)^4 - 8*P2.ddx*0^4 + 2*P1.ddx*(t2-t1)^4 + 80*P1.ddx*0^4 + 270*P2.x*(t2-t1)^2 - 378*P2.x*0^2 + 54*P1.x*(t2-t1)^2 + 216*P1.x*0^2 - 72*(t2-t1)^3*P2.dx + 18*(t2-t1)^3*P1.dx + 108*0^3*P2.dx - 216*0^3*P1.dx - 64*P2.ddx*(t2-t1)*0^3 + 14*P2.ddx*(t2-t1)^3*0 + 28*P1.ddx*(t2-t1)*0^3 - 5*P1.ddx*(t2-t1)^3*0 + 306*(t2-t1)*0^2*P2.dx - 18*(t2-t1)^2*0*P2.dx - 144*(t2-t1)*0^2*P1.dx + 18*(t2-t1)^2*0*P1.dx - 30*P2.ddx*(t2-t1)^2*0^2 - 24*P1.ddx*(t2-t1)^2*0^2 - 378*P2.x*(t2-t1)*0 + 216*P1.x*(t2-t1)*0)/(162*((t2-t1)*0 - 2*(t2-t1)^2 + 0^2));
pc3.t_ = t_b;

% Evaluate polynomials
for ii=1:L
    if tt(ii) < t_a
        pc = pc1;
    elseif tt(ii) < t_b
        pc = pc2;
    else
        pc = pc3;
    end
    [x(:,ii), dx(:,ii), ddx(:,ii)] = evaluate_polynomial (pc, tt(ii));
end

% Define trajectory structures
x_traj    = create_trajectory_structure(x,   Ts, tt + t1);
dx_traj   = create_trajectory_structure(dx,  Ts, tt + t1);
ddx_traj  = create_trajectory_structure(ddx, Ts, tt + t1);
end

function [p, dp, ddp] = evaluate_polynomial (pc, tt)
% Function to evaluate a polynomial
p   = (tt-pc.t_)^3*pc.a + (tt-pc.t_)^2*pc.b + (tt-pc.t_)*pc.c + pc.d;
dp  = pc.c + 3*pc.a*(tt-pc.t_)^2 + pc.b*(2*tt-2*pc.t_);
ddp = 2*pc.b + 3*pc.a*(2*tt- 2*pc.t_);
end

function t_r = round_to_Ts(t, Ts)
t_r = round(t/Ts)*Ts;
end